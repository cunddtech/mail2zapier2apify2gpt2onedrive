{
  "title": "Enhanced Email Actor v3.4.1 - Webhook Extension Input",
  "description": "Minimale Erweiterung für SipGate/WhatsApp Webhook-Support - nutzt bestehende WeClapp Integration und Datenbank",
  "type": "object",
  "schemaVersion": 1,
  "properties": {
    "payload_type": {
      "type": "string",
      "title": "Payload-Typ",
      "description": "Der Typ des Payloads, standardmäßig 'json'.",
      "default": "json",
      "editor": "textfield"
    },
    "wrap_in_array": {
      "type": "string",
      "title": "Wrap in Array",
      "description": "Ob der Payload in ein Array gewrappt werden soll.",
      "default": "no",
      "editor": "textfield"
    },
    "unflatten": {
      "type": "string",
      "title": "Unflatten",
      "description": "Ob der Payload unflach gemacht werden soll.",
      "default": "yes",
      "editor": "textfield"
    },
    "url": {
      "type": "string",
      "title": "URL",
      "description": "Die URL des Apify-Actors.",
      "default": "https://api.apify.com/v2/acts/cdtech~mail2zapier2apify2gpt2onedrive/runs?token=YOUR_APIFY_TOKEN_HERE",
      "editor": "textfield"
    },

    "body_content": {
      "type": "string",
      "title": "E-Mail/Message Content",
      "description": "Der Inhalt der E-Mail, Call Transcript oder WhatsApp Message.",
      "editor": "textarea"
    },
    "subject": {
      "type": "string",
      "title": "Subject/Call Info",
      "description": "Betreff der E-Mail oder Call/WhatsApp Info.",
      "editor": "textfield"
    },
    "from_email_address_name": {
      "type": "string",
      "title": "Sender Name",
      "description": "Name des Absenders/Anrufers/WhatsApp Kontakts.",
      "editor": "textfield"
    },
    "from_email_address_address": {
      "type": "string",
      "title": "Sender Contact",
      "description": "E-Mail-Adresse/Telefonnummer des Senders.",
      "editor": "textfield"
    },
    "to_recipients_email_address_address": {
      "type": "string",
      "title": "Recipient Contact",
      "description": "E-Mail-Adresse/Telefonnummer des Empfängers.",
      "editor": "textfield"
    },
    "message_id": {
      "type": "string",
      "title": "Message/Call/Chat ID",
      "description": "Die eindeutige ID der Nachricht/Anruf/Chat.",
      "editor": "textfield"
    },

    "callId": {
      "type": "string",
      "title": "SipGate Call ID",
      "description": "SipGate Call ID für Telefon-Webhooks (optional).",
      "editor": "textfield"
    },
    "event": {
      "type": "string",
      "title": "SipGate Event",
      "description": "SipGate Event Type (newCall, answer, hangup, dtmf).",
      "enum": ["newCall", "answer", "hangup", "dtmf", "hold"],
      "editor": "select"
    },
    "from": {
      "type": "string", 
      "title": "Caller Number",
      "description": "Telefonnummer des Anrufers (SipGate).",
      "editor": "textfield"
    },
    "to": {
      "type": "string",
      "title": "Called Number",
      "description": "Angerufene Telefonnummer (SipGate).",
      "editor": "textfield"
    },
    "user": {
      "type": "string",
      "title": "SipGate User", 
      "description": "SipGate User der den Anruf bearbeitet.",
      "editor": "textfield"
    },
    "duration": {
      "type": "number",
      "title": "Call Duration",
      "description": "Dauer des Anrufs in Sekunden (SipGate)."
    },
    "answered": {
      "type": "boolean",
      "title": "Call Answered",
      "description": "Wurde der Anruf angenommen (SipGate)."
    },
    "transcription": {
      "type": "string",
      "title": "Call/Voice Transcript", 
      "description": "AI-Transkript des Anrufs oder der Sprachnachricht.",
      "editor": "textarea"
    },

    "message_type": {
      "type": "string",
      "title": "WhatsApp Message Type",
      "description": "Art der WhatsApp Nachricht (optional).",
      "enum": ["text", "image", "document", "audio", "video", "location", "contact"],
      "editor": "select"
    },
    "sender_phone": {
      "type": "string",
      "title": "WhatsApp Sender Phone",
      "description": "Telefonnummer des WhatsApp Senders (optional).",
      "editor": "textfield"
    },
    "sender_name": {
      "type": "string",
      "title": "WhatsApp Sender Name", 
      "description": "Name des WhatsApp Senders (optional).",
      "editor": "textfield"
    },
    "message_text": {
      "type": "string",
      "title": "WhatsApp Message Text",
      "description": "Text-Inhalt der WhatsApp Nachricht (optional).",
      "editor": "textarea"
    },
    "chat_id": {
      "type": "string",
      "title": "WhatsApp Chat ID",
      "description": "Chat/Thread ID der WhatsApp Nachricht (optional).",
      "editor": "textfield"
    },
    "media_url": {
      "type": "string",
      "title": "Media URL",
      "description": "URL für WhatsApp Medien-Anhänge (optional).",
      "editor": "textfield"
    },
    "media_type": {
      "type": "string",
      "title": "Media Type",
      "description": "MIME Type der WhatsApp Medien-Datei (optional).",
      "editor": "textfield"
    },
    "is_group": {
      "type": "boolean",
      "title": "Group Message",
      "description": "Ist es eine WhatsApp Gruppennachricht."
    },
    "group_name": {
      "type": "string",
      "title": "Group Name",
      "description": "Name der WhatsApp Gruppe (optional).",
      "editor": "textfield"
    },

    "source": {
      "type": "string",
      "title": "Source",
      "description": "Quelle der Nachricht für Processing.",
      "default": "mail",
      "enum": ["mail", "zapier", "sipgate_webhook", "whatsapp_webhook", "webhook", "manual"],
      "editor": "select"
    },
    "zapier_webhook": {
      "type": "string",
      "title": "Zapier Webhook URL",
      "description": "Webhook URL für Zapier Integration (nutzt bestehende).",
      "editor": "textfield"
    },

    "railway_integration": {
      "type": "boolean",
      "title": "Railway Integration",
      "description": "Aktiviert Railway LangGraph AI Integration.",
      "default": true
    },
    "enable_contact_matching": {
      "type": "boolean",
      "title": "Contact Matching",
      "description": "Aktiviert bestehende WeClapp Contact Matching.",
      "default": true
    },
    "enable_task_generation": {
      "type": "boolean",
      "title": "Task Generation",
      "description": "Aktiviert AI-basierte Task Generation.",
      "default": true
    },
    "use_existing_integrations": {
      "type": "boolean",
      "title": "Use Existing Integrations",
      "description": "Nutzt bestehende WeClapp/Database Integrations.",
      "default": true
    },
    "workflow_type": {
      "type": "string",
      "title": "Workflow Type",
      "description": "Art des Processing Workflows.",
      "default": "webhook_extension_processing",
      "enum": [
        "webhook_extension_processing",
        "enhanced_email_processing", 
        "sipgate_call_processing",
        "whatsapp_message_processing",
        "existing_system_fallback"
      ],
      "editor": "select"
    },
    "debug_mode": {
      "type": "boolean",
      "title": "Debug Mode",
      "description": "Aktiviert erweiterte Debug-Ausgaben.",
      "default": false
    }
  },
  
  "required": [
    "payload_type",
    "wrap_in_array",
    "unflatten", 
    "url"
  ],
  
  "groups": [
    {
      "title": "Standard E-Mail Daten",
      "description": "Basis E-Mail-Informationen (funktioniert wie v3.4)",
      "properties": ["body_content", "subject", "from_email_address_name", "from_email_address_address", "to_recipients_email_address_address", "message_id"]
    },
    {
      "title": "SipGate Webhook Daten", 
      "description": "Zusätzliche Felder für SipGate Call Webhooks",
      "properties": ["callId", "event", "from", "to", "user", "duration", "answered", "transcription"]
    },
    {
      "title": "WhatsApp Webhook Daten",
      "description": "Zusätzliche Felder für WhatsApp Message Webhooks", 
      "properties": ["message_type", "sender_phone", "sender_name", "message_text", "chat_id", "media_url", "media_type", "is_group", "group_name"]
    },
    {
      "title": "Existing Integration Settings",
      "description": "Konfiguration für bestehende WeClapp/Database Integration",
      "properties": ["use_existing_integrations", "enable_contact_matching", "enable_task_generation"]
    },
    {
      "title": "Enhanced AI Features",
      "description": "Railway LangGraph AI Integration (wie v3.4)",
      "properties": ["railway_integration", "workflow_type"]
    },
    {
      "title": "Integration Settings",
      "description": "Webhook und Integration Konfiguration",
      "properties": ["source", "zapier_webhook", "url"]
    },
    {
      "title": "System Settings",
      "description": "System- und Debug-Konfiguration", 
      "properties": ["payload_type", "wrap_in_array", "unflatten", "debug_mode"]
    }
  ]
}